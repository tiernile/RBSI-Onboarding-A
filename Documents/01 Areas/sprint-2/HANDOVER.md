# Handover: Sprint 2 Testing Flow Prototype

## 1. Overview

This document details the work undertaken to create the **Sprint 2 Testing Flow**, a new journey prototype. The primary goal was to process a new CSV file (`RBSI Onboarding Sprint 2 Testing Flow v3.csv`) and render it as an interactive, schema-driven form within the existing Nuxt 3 application.

The prototype successfully parses the new data structure, integrates legacy "as-is" content for traceability, handles various field types, and presents the journey in the standard accordion layout.

## 2. How to Run the Prototype

1.  Ensure all dependencies are installed (`pnpm install`).
2.  Start the development server: `pnpm dev`.
3.  Navigate to Mission Control at `http://localhost:3000/`.
4.  Click the **"Sprint 2 Testing Flow"** card in the "Testing" group.
5.  Alternatively, access the journey directly at `http://localhost:3000/preview-kycp/sprint-2-testing-flow`.

## 3. Key Artefacts

-   **Source Data**: `apps/prototype/data/incoming/RBSI Onboarding Sprint 2 Testing Flow v3.csv`
    -   The primary source of truth for the journey's structure, questions, and field types.
-   **Import Script**: `apps/prototype/scripts/import_sprint_2_testing_flow.py`
    -   A bespoke Python script created to parse the CSV, map its columns to the schema format, and handle data cleaning.
-   **Generated Schema**: `apps/prototype/data/schemas/sprint-2-testing-flow/schema-kycp.yaml`
    -   The final YAML output that directly drives the UI. This file is generated by the import script.
-   **Journey Registration**: `apps/prototype/data/schemas/manifest.yaml`
    -   Updated to include an entry for `sprint-2-testing-flow`, making it visible in Mission Control.
-   **Rendering Component**: `apps/prototype/pages/preview-kycp/[journey].vue`
    -   The primary Vue component responsible for rendering the schema. Minor adjustments were made to this file to improve layout and readability.

## 4. Summary of Work

### 4.1. Core Implementation

-   **New Importer Creation**: A new script was developed to handle the specific structure of the Sprint 2 CSV. It maps columns like `Section`, `Keyname`, `Question`, `FIELD TYPE`, and `Lookup Values` to the corresponding schema properties (`accordions`, `key`, `label`, `style`, `type`, `options`).
-   **"As-Is" Content Integration**: The script cross-references the `Keyname` against the existing `non-lux-1-1` schema. Where a match is found, the original `label` and `help` text are embedded in the new schema under an `original` block. This is surfaced in the UI's "Explain Visibility" debug component for easy comparison.
-   **Rich Content Handling**: Logic was added to differentiate between standard input fields and content-only elements.
    -   `FIELD TYPE` values of `Title` and `Description` are now correctly mapped to `divider` and `statement` styles, preventing them from being rendered as input fields.
    -   The `Helper` text from `Title` rows in the CSV is now used as the `description` for the parent accordion, providing context at the top of each section.
-   **UI Adjustments**: The maximum width of the form was reduced in `preview-kycp/[journey].vue` to improve readability on wider screens.

### 4.2. Debugging and Resilience

The development process involved significant debugging, primarily related to data quality in the source CSV. The import script has been made more resilient to handle these issues.

-   **CSV Parsing Errors**: The script now programmatically corrects known formatting issues in the CSV, such as unquoted multi-line strings and extra delimiters, which were preventing the file from being parsed.
-   **Content Duplication**: A recurring issue where accordion subtitles were duplicated was traced to redundant data in the CSV. The import script now explicitly cleans this redundant data during processing to prevent the bug from reappearing.
-   **Data Integrity**: Several data-related bugs were identified and fixed at the source (in the CSV) and in the import script, including:
    -   Correcting a duplicated `Keyname` that caused user input to populate two different fields.
    -   Fixing incorrect section assignments that resulted in blank or misplaced accordions.
    -   Removing duplicated rows that caused introductory text to appear twice.

## 5. Next Steps & Known Issues

-   **Missing Lookup Values**: The import script's output includes several warnings for fields with a `type` of `lookup` that are missing options (e.g., `GENCashMngtAccTransCreditMonth`). This should be investigated; the data may need to be added to the source CSV or the `FIELD TYPE` corrected.
-   **Data Quality**: The source CSV has proven to be fragile. The next team should consider adding a more formal validation step (e.g., using a schema validation library like `pandera` for the dataframe) to the import script to catch errors early.
-   This handover marks the completion of the initial prototype build. The journey is now ready for further development, user testing, and refinement in Sprint 2.
